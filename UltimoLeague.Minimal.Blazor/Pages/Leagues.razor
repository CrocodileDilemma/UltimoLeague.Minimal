@page "/leagues"
@inherits MainPageBase
@inject IBaseService _service

<MudGrid>
    <MudItem xs="3">
        <MudPaper Class="d-flex align-center justify-center pa-16 ma-2" Elevation="3" Outlined="true" Square="true">
                <MudFab Icon="@Icons.Material.Filled.Add" Color="Color.Primary" IconSize="Size.Large" Title="Add new League" OnClick="HandleAdd"/>
        </MudPaper>
    </MudItem>
  
    @foreach (var league in leagues)
    {
        <MudItem xs="3">
            <MudPaper Class="d-flex align-center justify-center pa-16 ma-2" Elevation="3" Outlined="true" Square="true">
                @league.Name
            </MudPaper>
        </MudItem>
    }
</MudGrid>

@code {
    private List<LeagueDto> leagues { get; set; } = new();

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        await LoadData();
    }

    private async Task LoadData()
    {
        ErrorOr<IEnumerable<LeagueDto>> result = await _service.Get<IEnumerable<LeagueDto>>($"leagues/getBySportId/{currentSport.Id}");
        if (!result.IsError)
        {
            leagues = result.Value.ToList();
        }
    }

    private async Task HandleAdd()
    {
        var parameters = new DialogParameters();
        parameters.Add("sportId", currentSport.Id);
        var result = await _dialogService.Show<LeagueDialog>("Add League", parameters).Result;
        if (!result.Cancelled)
        {
            await LoadData();
            this.StateHasChanged();
        }
    }
}
